<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <ul class="nav nav-pills">
      <li><span data-lang="aliases" class="title text-default"></span></li>
      <li><button class="btn btn-success plus-button" onclick="alias.new()" style="padding: 9px 15px;"><i class="fa fa-plus" aria-hidden="true"></i></button></li>
      <li class="active"><a data-toggle="tab" href="#manage">Manage</a></li>
      <li><a data-toggle="tab" href="#responses">Responses</a></li>
    </ul>
  </div>


<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="manage">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="widget">
          <table class="table table-striped table-responsive table-condensed">
            <tbody id="Alias"></tbody>
          </table>
        </div>
      </div>
    </div>


  <div role="tabpanel" class="tab-pane" id="responses">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <div class="widget">
          <table class="table table-striped table-responsive table-condensed">
              <tbody id="Responses">
                <tr>
                  <td colspan="2">
                    <kbd>!alias add !$command !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-success">Success</span>
                    <span class="custom-response" data-id="alias.success.add"></span>
                  </td>
                  <td colspan="2">
                    <kbd>!alias add !$command !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-danger">Failure</span>
                    <span class="custom-response" data-id="alias.failed.add"></span>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">
                    <kbd>!alias remove !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-success">Success</span>
                    <span class="custom-response" data-id="alias.success.remove"></span>
                  </td>
                  <td colspan="2">
                    <kbd>!alias remove !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-danger">Failure</span>
                    <span class="custom-response" data-id="alias.failed.remove"></span>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">
                    <kbd>!alias list</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-success">Populated $list</span>
                    <span class="custom-response" data-id="alias.success.list"></span>
                  </td>
                  <td colspan="2">
                    <kbd>!alias list</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-warning">Empty</span>
                    <span class="custom-response" data-id="alias.failed.list"></span>
                  </td>
                </tr>
                <tr>
                  <td>
                    <kbd>!alias toggle !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-success">Enabled</span>
                    <span class="custom-response" data-id="alias.success.enabled"></span>
                  </td>
                  <td colspan="2">
                    <kbd>!alias toggle !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-warning">Disabled</span>
                    <span class="custom-response" data-id="alias.success.disabled"></span>
                  </td>
                  <td>
                    <kbd>!alias toggle !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-danger">Failure</span>
                    <span class="custom-response" data-id="alias.failed.toggle"></span>
                  </td>
                </tr>
                <tr>
                  <td>
                    <kbd>!alias toggle-visibility !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-success">Visible</span>
                    <span class="custom-response" data-id="alias.success.visible"></span>
                  </td>
                  <td colspan="2">
                    <kbd>!alias toggle-visibility !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-warning">Invisible</span>
                    <span class="custom-response" data-id="alias.success.invisible"></span>
                  </td>
                  <td>
                    <kbd>!alias toggle-visibility !$alias</kbd>
                    <span class="label label-primary">Response</span> <span class="label label-danger">Failure</span>
                    <span class="custom-response" data-id="alias.failed.visible"></span>
                  </td>
                </tr>
              </tbody>
            </table>
      </div>
  </div>
</div>

<script>
  var alias = {
    list: {},
    cancel: function () {
      $('#new-alias').css('display', 'none')
      $('.new-confirm-btn').css('display', 'none')
      this.update(this.list)
    },
    new: function () {
      $('#new-alias').css('display', 'table-row')
      $('.new-confirm-btn').css('display', 'block')

      $('[contenteditable=true]').off()
      $('#new-alias [contenteditable=true]:first').keyup(function (ev) {
        var alias = $(ev.target).text().trim()
        if (!alias.startsWith('!')) alias = '!' + alias
        socket.emit('parser.isRegistered', { emit: 'alias.check', command: alias })
      })
    },
    update: function (list) {
      this.list = list
      $("#Alias").empty()
      $("#Alias").append('<tr id="new-alias" style="display:none">' +
          '<td style="vertical-align: top !important;"><span class="label label-default">New alias</span> <span class="status label label-warning">available</span>' + commons.editable('', '_new!', 'commons.stub') + '</td>' +
          '<td style="vertical-align: top !important;"><span class="label label-primary">Response</span> ' +
              commons.editable('<empty response>', '_new!', 'alias.stub') +
          '<div class="btn-group pull-right">' +
            '<button class="save-button btn btn-success new-confirm-btn" style="display:none" onclick="alias.create(event)">SAVE</button>' +
            '<button class="btn btn-warning new-confirm-btn" style="display:none" onclick="alias.cancel()">CANCEL</button>' +
          '</div>' +
          '</td>' +
          '</tr>');
      _.each(list, function(item, index) {
        $("#Alias").append('<tr class="page-data-row">' +
            '<td style="vertical-align: top !important;"><span class="label label-default">Alias</span>' + commons.editable('!' + item.alias, item.alias, 'alias.editName') + '</td>' +
            '<td style="vertical-align: top !important;"><span class="label label-primary">Command</span> ' +
              '<span style="cursor: pointer;" class="label label-' + (item.visible ? "success": "danger") + '" " data-id="' + item.alias + '" onclick="alias.toggleVisibility(this)">' + (item.visible ? "visible": "hidden") + '</span> ' +
              '<span style="cursor: pointer;" class="label label-' + (item.enabled ? "success": "danger") + '" data-id="' + item.alias + '" onclick="alias.toggle(this)">' + (item.enabled ? "enabled": "disabled") + '</span>' +
              '<span style="cursor: not-allowed; float:right; padding: 4px;" class="label label-danger btn-remove" data-id="' + item.alias + '"  onclick="commons.confirm(this)">delete</span>' +
              '<span style="cursor: not-allowed; float:right; padding: 4px; display: none" class="label label-warning btn-confirm" onclick="commons.unconfirm(this)">cancel</span>' +
              '<span style="cursor: not-allowed; float:right; padding: 4px; display: none" class="label label-success btn-confirm" onclick="alias.delete(this)" data-id="' + item.alias + '">confirm</span>' +
              commons.editable('!' + item.command, item.alias, 'alias.edit') +
            '</td>' +
          '</tr>');
      })
    },
    editName: function (id, value) {
      socket.emit('alias.edit.id', {id: id, value: value}).emit('alias.get')
    },
    edit: function (id, value) {
      socket.emit('alias.edit', {id: id, value: value}).emit('alias.get')
    },
    delete: function (el) {
      socket.emit('alias.delete', el.dataset.id).emit('alias.get')
    },
    toggle: function (el) {
      socket.emit('alias.toggle', el.dataset.id).emit('alias.get')
    },
    toggleVisibility: function (el) {
      socket.emit('alias.toggle.visibility', el.dataset.id).emit('alias.get')
    },
    create: function (event) {
      event.preventDefault()
      var inputs = $('[data-id="_new!"]')
      var data = {alias: $(inputs[0]).text().replace('!', ''), command: $(inputs[1]).text().replace('!', '')}
      socket.emit('alias.create', data).emit('alias.get')
      $('.new-confirm-btn').css('display', 'none')
    },
    responses: function () {
      socket.emit('responses.get', 'alias', function (data) {
        _.each(data, function (value, key) {
          key = 'alias.' + key
          $('[data-id="' + key + '"]').html(commons.editable(value, key, 'commons.setResponse'))
        })
      })
    }
  }

  alias.responses()

  socket.emit('alias.get');

  socket.on('alias', function(list) {
    alias.update(list)
  })

  socket.on('alias.check', function (data) {
    if (data.isRegistered) {
      $('.status').removeClass().addClass('label label-danger status')
      $('.save-button').prop('disabled', true)
    } else {
      $('.status').removeClass().addClass('label label-success status')
      $('.save-button').prop('disabled', false)
    }
  })

  $('a[data-toggle="tab"]').off()
  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    var target = $(e.target).attr("href") // activated tab
    if (target === '#manage') {
      $('.plus-button').prop('disabled', false)
    } else {
      $('.plus-button').prop('disabled', true)
    }
  })
</script>
